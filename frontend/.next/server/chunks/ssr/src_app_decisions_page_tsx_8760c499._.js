module.exports=[77374,a=>{"use strict";a.s(["default",()=>M],77374);var b=a.i(87924),c=a.i(72131),d=a.i(91119),e=a.i(86304),f=a.i(99570),g=a.i(66718),h=a.i(33217),i=a.i(87097),j=a.i(97580),k=a.i(86456),l=a.i(14574),m=a.i(41921),n=a.i(29246),o=a.i(41710),p=a.i(95245),q=a.i(59501),r=a.i(54714),s=a.i(70025),t=a.i(37927),u=a.i(23292),v=a.i(42724),w=a.i(74016);function x(a,b,c){let d=(0,w.toDate)(a,c?.in);return isNaN(b)?(0,v.constructFrom)(c?.in||a,NaN):(b&&d.setDate(d.getDate()+b),d)}var y=a.i(56711),z=a.i(60178);let A=r.object({d_plus_7_review:r.string().min(1,"D+7 리뷰를 입력해주세요")});function B({decisionId:a,taskId:d,decisionDate:e,existingReview:g,triggerText:h="D+7 리뷰"}){let[j,k]=(0,c.useState)(!1),r=(0,t.useQueryClient)(),v=(0,y.format)(x((0,z.parseISO)(e),7),"yyyy-MM-dd"),w=new Date>=x((0,z.parseISO)(e),7),B=(0,p.useForm)({resolver:(0,q.zodResolver)(A),defaultValues:{d_plus_7_review:g||""}}),C=(0,s.useMutation)({mutationFn:({id:a,data:b})=>(0,i.updateDecisionD7Review)(a,b),onSuccess:()=>{u.toast.success("D+7 리뷰가 저장되었습니다!"),r.invalidateQueries({queryKey:["decisions",d]}),r.invalidateQueries({queryKey:["all-decisions"]}),k(!1)},onError:a=>{let b=a?.response?.data?.detail||"리뷰 저장에 실패했습니다.";u.toast.error(b),console.error("Error updating D+7 review:",a)}}),D=async b=>{C.mutate({id:a,data:{d_plus_7_review:b.d_plus_7_review}})};return(0,b.jsxs)(l.Dialog,{open:j,onOpenChange:k,children:[(0,b.jsx)(l.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{variant:g?"secondary":"outline",size:"sm",className:w?"":"opacity-50",children:[(0,b.jsx)(o.Clock,{className:"mr-2 h-4 w-4"}),g?"리뷰 수정":h]})}),(0,b.jsxs)(l.DialogContent,{className:"sm:max-w-[600px]",children:[(0,b.jsxs)(l.DialogHeader,{children:[(0,b.jsxs)(l.DialogTitle,{children:["D+7 리뷰 ",g?"수정":"작성"]}),(0,b.jsxs)(l.DialogDescription,{children:["결정일로부터 7일 후(",v,")에 실시하는 회고입니다.",!w&&" 아직 리뷰 시점이 아니지만 미리 작성할 수 있습니다."]})]}),(0,b.jsx)(m.Form,{...B,children:(0,b.jsxs)("form",{onSubmit:B.handleSubmit(D),className:"space-y-4",children:[(0,b.jsx)(m.FormField,{control:B.control,name:"d_plus_7_review",render:({field:a})=>(0,b.jsxs)(m.FormItem,{children:[(0,b.jsx)(m.FormLabel,{children:"D+7 리뷰 *"}),(0,b.jsx)(m.FormControl,{children:(0,b.jsx)(n.Textarea,{placeholder:"7일이 지난 시점에서 이 결정을 어떻게 평가하나요?  - 결정이 올바랗았나요? - 예상했던 결과가 나왔나요? - 가정사항과 리스크는 어떻게 되었나요? - 다시 결정한다면 어떻게 하시겠나요?",className:"min-h-[150px]",...a})}),(0,b.jsx)(m.FormMessage,{})]})}),(0,b.jsxs)("div",{className:"flex justify-end space-x-2 pt-4",children:[(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>k(!1),children:"취소"}),(0,b.jsx)(f.Button,{type:"submit",disabled:C.isPending,children:C.isPending?"저장 중...":"저장"})]})]})})]})]})}var C=a.i(63588),D=a.i(87532),E=a.i(41675),F=a.i(96101),G=a.i(92e3);let H=(0,a.i(70106).default)("circle-check",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var I=a.i(69439),J=a.i(50429);function K(a){return+(0,w.toDate)(a)<Date.now()}var L=a.i(38246);function M(){let[a,l]=(0,c.useState)(""),{data:m,isLoading:n}=(0,h.useQuery)({queryKey:["all-decisions"],queryFn:i.getAllDecisions,retry:!1}),{data:p,isLoading:q}=(0,j.useTasks)(),{data:r,isLoading:s}=(0,k.useProjects)(),t=p?.reduce((a,b)=>(a[b.id]=b,a),{})||{},u=r?.reduce((a,b)=>(a[b.id]=b,a),{})||{},v=m?.filter(b=>{if(!a)return!0;let c=a.toLowerCase(),d=t[b.task_id],e=d?u[d.project_id]:null;return b.problem.toLowerCase().includes(c)||b.options.toLowerCase().includes(c)||b.decision_reason.toLowerCase().includes(c)||b.assumptions_risks.toLowerCase().includes(c)||b.d_plus_7_review?.toLowerCase().includes(c)||d?.title.toLowerCase().includes(c)||e?.name.toLowerCase().includes(c)})||[],w={total:m?.length||0,withReview:m?.filter(a=>a.d_plus_7_review).length||0,pendingReview:m?.filter(a=>!a.d_plus_7_review&&K(x((0,z.parseISO)(a.date),7))).length||0};return n||q||s?(0,b.jsx)("div",{className:"container mx-auto p-6",children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-primary border-t-transparent mx-auto"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"의사결정을 불러오는 중..."})]})})}):(0,b.jsxs)("div",{className:"container mx-auto p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,b.jsx)(C.MessageSquare,{className:"h-8 w-8"}),"의사결정 로그"]}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Decision Log + D+7 리뷰 - 중요한 의사결정과 회고"})]}),(0,b.jsxs)("div",{className:"relative max-w-md",children:[(0,b.jsx)(D.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"의사결정 내용, 작업명, 프로젝트명으로 검색...",value:a,onChange:a=>l(a.target.value),className:"pl-10"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-3",children:(0,b.jsx)(d.CardTitle,{className:"text-lg",children:"전체 의사결정"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"text-3xl font-bold",children:w.total})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-3",children:(0,b.jsx)(d.CardTitle,{className:"text-lg",children:"리뷰 완료"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"text-3xl font-bold text-green-600",children:w.withReview})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{className:"pb-3",children:(0,b.jsx)(d.CardTitle,{className:"text-lg",children:"리뷰 대기"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("div",{className:"text-3xl font-bold text-orange-600",children:w.pendingReview})})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsxs)(d.CardHeader,{children:[(0,b.jsx)(d.CardTitle,{children:"의사결정 목록"}),(0,b.jsx)(d.CardDescription,{children:v.length?`${v.length}개의 의사결정 기록`:"검색 조건에 맞는 의사결정이 없습니다"})]}),(0,b.jsx)(d.CardContent,{children:0===v.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(C.MessageSquare,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:0===w.total?"작성된 의사결정이 없습니다":"검색 결과가 없습니다"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:0===w.total?"프로젝트 상세 페이지에서 작업별로 의사결정을 기록해보세요":"다른 검색어로 시도해보세요"}),0===w.total&&(0,b.jsx)(f.Button,{asChild:!0,children:(0,b.jsx)(L.default,{href:"/projects",children:"프로젝트 보기"})})]}):(0,b.jsx)("div",{className:"space-y-6",children:v.sort((a,b)=>new Date(b.date).getTime()-new Date(a.date).getTime()).map(a=>{let c=t[a.task_id],g=c?u[c.project_id]:null,h=x((0,z.parseISO)(a.date),7),i=K(h);return(0,b.jsxs)(d.Card,{className:"border-l-4 border-l-purple-500",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsxs)(e.Badge,{variant:"outline",className:"flex items-center gap-1",children:[(0,b.jsx)(E.Calendar,{className:"h-3 w-3"}),(0,y.format)((0,z.parseISO)(a.date),"yyyy-MM-dd")]}),a.d_plus_7_review?(0,b.jsxs)(e.Badge,{variant:"default",className:"bg-green-600 flex items-center gap-1",children:[(0,b.jsx)(H,{className:"h-3 w-3"}),"리뷰 완료"]}):i?(0,b.jsxs)(e.Badge,{variant:"destructive",className:"flex items-center gap-1",children:[(0,b.jsx)(G.AlertCircle,{className:"h-3 w-3"}),"리뷰 필요"]}):(0,b.jsxs)(e.Badge,{variant:"secondary",className:"flex items-center gap-1",children:[(0,b.jsx)(o.Clock,{className:"h-3 w-3"}),"리뷰 대기"]})]}),c&&(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(F.FolderOpen,{className:"h-4 w-4"}),(0,b.jsx)(L.default,{href:`/projects/${c.project_id}`,className:"hover:underline",children:g?.name||`프로젝트 ${c.project_id}`})]}),(0,b.jsxs)("span",{children:["→ ",c.title]})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(B,{decisionId:a.id,taskId:a.task_id,decisionDate:a.date,existingReview:a.d_plus_7_review})})]})}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"font-semibold text-sm text-muted-foreground mb-1 flex items-center gap-1",children:[(0,b.jsx)(G.AlertCircle,{className:"h-3 w-3"}),"문제 상황"]}),(0,b.jsx)("p",{className:"text-sm",children:a.problem})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"font-semibold text-sm text-muted-foreground mb-1 flex items-center gap-1",children:[(0,b.jsx)(I.Lightbulb,{className:"h-3 w-3"}),"검토한 옵션들"]}),(0,b.jsx)("p",{className:"text-sm",children:a.options})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h4",{className:"font-semibold text-sm text-muted-foreground mb-1 flex items-center gap-1",children:[(0,b.jsx)(J.Target,{className:"h-3 w-3"}),"결정 이유"]}),(0,b.jsx)("p",{className:"text-sm",children:a.decision_reason})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-sm text-muted-foreground mb-1",children:"가정사항 & 리스크"}),(0,b.jsx)("p",{className:"text-sm",children:a.assumptions_risks})]}),a.d_plus_7_review&&(0,b.jsxs)("div",{className:"border-t pt-4",children:[(0,b.jsxs)("h4",{className:"font-semibold text-sm text-muted-foreground mb-1 flex items-center gap-1",children:[(0,b.jsx)(H,{className:"h-3 w-3"}),"D+7 리뷰 (",(0,y.format)(h,"yyyy-MM-dd"),")"]}),(0,b.jsx)("p",{className:"text-sm bg-muted p-3 rounded-md",children:a.d_plus_7_review})]}),(0,b.jsx)("div",{className:"flex justify-end pt-2",children:(0,b.jsx)(f.Button,{asChild:!0,variant:"outline",size:"sm",children:(0,b.jsx)(L.default,{href:`/projects/${c?.project_id}`,children:"작업 보기"})})})]})]},a.id)})})})]})]})}}];

//# sourceMappingURL=src_app_decisions_page_tsx_8760c499._.js.map